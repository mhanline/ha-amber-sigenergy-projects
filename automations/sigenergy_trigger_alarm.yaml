# Copyright 2025 Michael Hanline
# SPDX-License-Identifier: Apache-2.0
#################################################################
## 
## Notifies if there is an alarm generated by the Sigenergy
## system. Ignores unknown events (such as when rebooting)
## 
#################################################################

- id: 'sigenergy_trigger_alarm'
  alias: Sigenergy Alarm Notification
  description: 'Triggered upon receiving any alarms from Sigenergy plant'
  triggers:
  - trigger: state
    entity_id:
    - sensor.sigen_plant_general_alarm_1
    - sensor.sigen_plant_general_alarm_2
    - sensor.sigen_plant_general_alarm_3
    - sensor.sigen_plant_general_alarm_4
    - sensor.sigen_plant_general_alarm_5
    not_from:
    - unknown
    - unavailable
  conditions: []
  actions:
  - action: notify.notify
    metadata: {}
    data:
      message: Alarm {{ trigger.name }} from {{ trigger.from_state }} to {{ trigger.to_state }}
  mode: single
  trace:
    stored_traces: 20